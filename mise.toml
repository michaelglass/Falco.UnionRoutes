[tools]
dotnet = "10.0"

[tasks.restore]
description = "Restore dependencies"
run = "dotnet restore"

[tasks.build]
description = "Build the solution"
run = "dotnet build"
depends = ["restore"]

[tasks.test]
description = "Run tests with coverage"
run = "dotnet test --collect:\"XPlat Code Coverage\" --results-directory ./coverage"
depends = ["build"]

[tasks.example]
description = "Run the example app"
run = "dotnet run --project examples/ExampleApp"
depends = ["build"]

[tasks.example-build]
description = "Build the example app (for CI)"
run = "dotnet build examples/ExampleApp --warnaserror"
depends = ["build"]

[tasks.format]
description = "Format code with Fantomas"
run = "dotnet fantomas src/ tests/ examples/"

[tasks.format-check]
description = "Check formatting without making changes"
run = "dotnet fantomas src/ tests/ examples/ --check"

[tasks.lint]
description = "Run FSharpLint"
run = "dotnet fsharplint lint Falco.UnionRoutes.sln"
depends = ["build"]

[tasks.coverage-check]
description = "Check per-file coverage meets minimum threshold (50%)"
run = "dotnet fsi scripts/check-coverage.fsx"
depends = ["test"]

[tasks.check-api]
description = "Check API changes since last release"
run = "dotnet fsi scripts/check-api.fsx"
depends = ["build"]

[tasks.sync-docs]
description = "Sync README.md content to docs/index.md"
run = "dotnet fsi scripts/sync-docs.fsx"

[tasks.sync-docs-check]
description = "Check if docs/index.md is in sync with README.md"
run = "dotnet fsi scripts/sync-docs.fsx --check"

[tasks.check]
description = "Run all checks with auto-fix (format, sync-docs, then verify)"
depends = ["format", "sync-docs", "lint", "coverage-check", "docs", "example-build"]

[tasks.ci]
description = "Run all CI checks (no auto-fix)"
depends = ["format-check", "lint", "coverage-check", "sync-docs-check", "docs", "example-build"]

[tasks.pack]
description = "Create NuGet package"
run = "dotnet pack src/Falco.UnionRoutes/Falco.UnionRoutes.fsproj -c Release"
depends = ["build"]

[tasks.docs]
description = "Generate API documentation"
run = "dotnet fsdocs build --output output/docs --clean"
depends = ["build"]

[tasks.docs-watch]
description = "Watch and serve documentation locally"
run = "dotnet fsdocs watch"
depends = ["build"]
