[tools]
dotnet = "10.0"

[tasks.restore]
description = "Restore dependencies"
run = "dotnet restore"

[tasks.build]
description = "Build the solution"
run = "dotnet build"
depends = ["restore"]

[tasks.test]
description = "Run tests with coverage"
run = "dotnet test --collect:\"XPlat Code Coverage\" --results-directory ./coverage"
depends = ["build"]

[tasks.example]
description = "Run the example app"
run = "dotnet run --project examples/ExampleApp"
depends = ["build"]

[tasks.example-build]
description = "Build the example app (for CI)"
run = "dotnet build examples/ExampleApp --warnaserror"
depends = ["build"]

[tasks.format]
description = "Format code with Fantomas"
run = "dotnet fantomas src/ tests/ examples/"

[tasks.format-check]
description = "Check formatting without making changes"
run = "dotnet fantomas src/ tests/ examples/ --check"

[tasks.lint]
description = "Run FSharpLint"
run = "dotnet fsharplint lint Falco.UnionRoutes.sln"
depends = ["build"]

[tasks.coverage-check]
description = "Check per-file coverage meets minimum threshold (50%)"
run = "dotnet fsi scripts/check-coverage.fsx"
depends = ["test"]

[tasks.ci]
description = "Run all CI checks"
depends = ["format-check", "lint", "coverage-check", "docs", "example-build"]

[tasks.pack]
description = "Create NuGet package"
run = "dotnet pack src/Falco.UnionRoutes/Falco.UnionRoutes.fsproj -c Release"
depends = ["build"]

[tasks.docs]
description = "Generate API documentation"
run = "dotnet fsdocs build --output output/docs --clean"
depends = ["build"]

[tasks.docs-watch]
description = "Watch and serve documentation locally"
run = "dotnet fsdocs watch"
depends = ["build"]

[tasks.release]
description = "Create and push a release tag (args: patch|minor|major)"
run = "dotnet fsi scripts/release.fsx ${1:-patch}"
depends = ["ci"]
